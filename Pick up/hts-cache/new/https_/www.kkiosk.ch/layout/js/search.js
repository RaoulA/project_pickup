/*!
 * mcsearch.js
 */
jQuery(document).ready(function($){var $container=$('[data-search="container"]');var $template=$($('[data-search="template"]').html());var searchTerm='';$('[data-search="query-input"]').autocomplete({source:"/_lib/search/jsonAutocomplete.php",autoFocus:true,search:function(event,ui){},open:function(event,ui){searchTerm=$('[data-search="query-input"]').val();},close:function(event,ui){var content=$('[data-search="query-input"]').val();var string=searchTerm.substring(0,searchTerm.lastIndexOf(" "))+" "+content;searchTerm='';$('[data-search="query-input"]').val(string);var q=$container.attr('data-search-query');var lang=$container.attr('data-search-lang');var mime=$container.attr('data-search-mime');fetchResults(string,lang,mime,0,20);}});var last={'q':'','lang':'','mime':'','from':'','count':''};var $button=$('[data-search="more-button"]');$button.remove();var fetchResults=function(q,lang,mime,from,count){if($('[data-search="spinner"]').length){return false;}
$button.remove();var request={'q':q,'lang':lang,'mime':mime,'from':from,'count':count};if(typeof q=='object'){request=last;request.from=request.from+request.count;}else{last=request;}
var $spinner=$('<div data-search="spinner"><i class="fa fa-spinner fa-spin"></i></div>');$container.append($spinner);$.getJSON('/_lib/search/jsonSearch.php',request,function(data){$('[data-search="result-count"]').html(data.resultCount);$.each(data.results,function(i,d){var $t=$template.clone();var $title=$('<a href="'+d.url+'">'+d.title+'</a>');$t.find('[data-search="title"]').append($title);$t.find('[data-search="lang"]').html(d.lang);$t.find('[data-search="preview"]').html(d.preview);$t.find('[data-search="url"]').html(d.url);$container.append($t);});if(request.from+request.count<=data.resultCount){$container.append($button);}
$spinner.remove();$('.autoheight').autoHeight(40);});};$('body').delegate('[data-search="more-button"]','click',fetchResults);if($container.length){var q=$container.attr('data-search-query');var lang=$container.attr('data-search-lang');var mime=$container.attr('data-search-mime');fetchResults(q,lang,mime,0,20);}});