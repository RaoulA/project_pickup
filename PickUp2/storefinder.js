(function(i){var __={"INI":{"PATH":{"IMG":"//api.valora-stores.com/uploads/images/","CSS":"//api.valora-stores.com/uploads/images/css/","ROOT":"//api.valora-stores.com/","SCRIPT":"//api.valora-stores.com/_index.php?","DATA":"//api.valora-stores.com/_index.php?"},"CFG":{"ACSYNC":1,"LOG_ALERT":1,"LOG_ERROR":2,"LOG_WARN":4,"LOG_INFO":8,"LOG_LOG":16},"USR":{"LOG":1,"GOOLANG":"","GOOKEY":"","NS":"storefinder","CFG":0,"CFGS":{"services_uncheck":1,"formats_uncheck":2,"services_showallifnone":4,"formats_showallifnone":8,"anyservice":16}},"DATA":{"LOG":"log","GOOLANG":"goolang","NS":"namespace","CFG":"cfg","GOOKEY":"gookey"},"LOCATE":{"google":1},"RUN":{"api":"api","data":"data","frame":"frame","frame_map":"frame_map","frame_list":"frame_list","css":"css","gen":"gen"},"PARAM":{"callback":"cb","key":"key","action":"a","lang":"l","namespace":"ns","framed":"f","goolang":"gl","cfg":"cc"},"FRAMED":0},"API_ERR":null,"KEY":"JNhf7hGbhZJM84HnbGv8JnfGde9kHmdD","IL8N":{"d_mon":"Montag","d_tue":"Dienstag","d_wed":"Mittwoch","d_thu":"Donnerstag","d_fri":"Freitag","d_sat":"Samstag","d_sun":"Sonntag","nearby1":"Verkaufstellen in deiner N\u00e4he","nearby2":"Deine n\u00e4chsten Verkaufsstellen","opentoday":"Heute noch ge\u00f6ffnet *","openthen":"ge\u00f6ffnet am n\u00e4chsten *","openat":"um *","timeformat":"z. B. 14:30","insertaddress":"Gib eine Adresse ein\u2026","insertaddress2":"Ort oder PLZ (ggf. Strasse, Hausnummer)","gotomap":"auf Karte anzeigen","offset":"entfernt","crow":"Luftline","car":"Auto","minute":"Minute","minutes":"Minuten","hour":"Stunde","hours":"Stunden","and":"und","remaining":"Hat noch","opened":"offen","closed":"geschlossen","open_times":"\u00d6ffnungszeiten","submit":"ok","hint":"Tipp","hint_search":"Gib Deinen <strong>Ort</strong> oder Deine <strong>Postleitzahl</strong> in der Suchmaske ein oder benutze die Filterfunktion, um Dir passende Verkaufsstellen in Deiner N\u00e4he anzeigen zu lassen.","pagetitle":"VALORA Storefinder","insertaddress3":"Adresse eingeben"},"TPL":{"infobox":"<div class=\"@@a:ns@@_iw\"> \n \n <img src=\"//api.valora-stores.com/uploads/images/@@a:format_logo@@\" height=\"40\" style=\"display: block;\"/>\n <!-- edit by dc: pre-edit width=\"150\", post-edit height=\"40\" -->\n \n <span class=\"@@a:ns@@_iw_distance\" data-distance=\"@@a:distance@@\">\n   <a href=\"@@a:router@@\" target=\"gdir\">@@a:distance@@</a>\n </span>\n \n <span class=\"@@a:ns@@_iw_h1\">@@a:store_name@@</span>\n <address class=\"@@a:ns@@_iw_address\">\n   <span>@@a:store_street@@ @@a:store_streetnr@@</span>\n   <span>@@a:store_zip@@ @@a:store_city@@</span>\n   <span>@@a:country_name@@</span>\n </address>\n <div>@@a:remaining@@</div>\n <div class=\"@@a:ns@@_iw_services\">@@a:services@@</div>\n</div>","infobox_storeopen":"<!--\n!!!!!!!!!\n\nder auskommentierte quellcode ist veraltet / nicht korrekt. \nuntenstehend der neue zusammengef\u00fchrte quellcode aus map.htm VOR und NACH update\n\n!!!!!!!!!\n\n\n\n<ul class=\"isopen\">\n  <li>@@l:remaining@@\n    <span style=\"display:@@a:display@@\">@@a:hh@@ @@a:hours@@ @@l:and@@</span>\n    <span>@@a:mm@@ @@a:minutes@@  @@l:opened@@</span>\n  </li>\n</ul>\n\n-->\n\n\n<ul class=\"isopen\">\n  <li>@@l:remaining@@\n    <span style=\"display: @@a:display@@;\">@@a:hh@@ @@a:hours@@ @@l:and@@</span>\n    <span>@@a:mm@@ @@a:minutes@@  @@l:opened@@</span>\n  </li>\n</ul>","list_item":"  <div id=\"@@a:ns@@_list_item_@@a:store_id@@\">\n    <address>\n      <!--<span><img height=\"30\" src=\"@@a:root@@@@a:format_logo@@\"/></span>-->\n      <strong>@@a:store_name@@</strong>\n      <span>@@a:store_street@@ @@a:store_streetnr@@</span>\n      <span>@@a:store_zip@@ @@a:store_city@@</span>\n      <span>@@a:store_country@@</span>\n      <!--<span>@@a:services@@</span>-->\n      <span class=\"@@a:ns@@_list_item_distance\">\n        <span class=\"@@a:ns@@_list_item_km\">@@a:distance@@</span>km @@l:offset@@\n        (<span class=\"@@a:ns@@_list_item_mode\">@@l:crow@@</span>)\n      </span>\n    </address>\n    <span class=\"@@a:ns@@_list_item_intoview\" title=\"@@l:gotomap@@\">&nbsp;&nbsp;</span>\n  </div>","list_item_service":"<img class=\"@@a:ns@@_list_item_service_logo\" src=\"@@a:img_root@@@@a:service_logo@@\" title=\"@@a:service_name@@\"/> \n","win_item_service":"<img class=\"@@a:ns@@_list_item_service_logo\" src=\"@@a:img_root@@@@a:service_logo@@\" title=\"service_name\"/>\n","open_time":"<ul class=\"open_times @@a:open_class@@\">\n  <li>\n    <strong>@@a:open_times@@</strong>\n    <span>@@a:open_time_a@@</span>\n    <span>@@a:open_time_b@@</span>\n    <strong>(@@a:is_open@@)</strong>\n  </li>\n</ul>\n","toolbar":"","list":"<!--\n!!!!!!!!!\n\nder auskommentierte quellcode ist veraltet / nicht korrekt. \nuntenstehend der neue zusammengef\u00fchrte quellcode aus map.htm VOR und NACH update\n\n!!!!!!!!!\n\n<div class=\"@@s:ns@@_list_wrapper\">\n  <h1>@@l:nearby1@@</h1>\n  <div class=\"@@s:ns@@_list_column @@s:ns@@_list_input_holder\">\n    <div class=\"@@s:ns@@_list_formelement\">\n      <input autocomplete=\"off\" id=\"@@s:ns@@_ac_list\" placeholder=\"@@l:insertaddress2@@\"></div>\n    <div class=\"@@s:ns@@_list_formelement\"><input id=\"@@s:ns@@_list_opennow\" name=\"@@s:ns@@_open\" type=\"radio\">@@l:opentoday@@</div>\n    <div class=\"@@s:ns@@_list_formelement\"><input id=\"@@s:ns@@_list_openthen\" name=\"@@s:ns@@_open\" type=\"radio\">@@l:openthen@@</div>\n    <div class=\"@@s:ns@@_list_formelement\">\n      <select id=\"@@s:ns@@_list_day\">\n        <option value=\"1\">@@l:d_mon@@</option>\n        <option value=\"2\">@@l:d_tue@@</option>\n        <option value=\"3\">@@l:d_wed@@</option>\n        <option value=\"4\">@@l:d_thu@@</option>\n        <option value=\"5\">@@l:d_fri@@</option>\n        <option value=\"6\">@@l:d_sat@@</option>\n        <option value=\"0\">@@l:d_sun@@</option>\n      </select>\n    </div>\n\t  <div class=\"@@s:ns@@_list_formelement\">@@l:openat@@</div>\n\t  <input type=\"time\" id=\"@@s:ns@@_list_openat\" placeholder=\"@@l:timeformat@@\">\n  </div>\n  <div class=\"@@s:ns@@_list_column @@s:ns@@_list_items_holder\">\n    <h3 class=\"@@s:ns@@_list_item_holder_title\">@@l:nearby2@@</h3>\n    <div id=\"@@s:ns@@_list_items\">\n    <h2>@@l:hint@@</h2>\n    <p>\n      @@l:hint_search@@\n    </p>\n    </div>\n  </div>\n</div>\n\n-->\n\n<div class=\"@@s:ns@@_list_wrapper\">\n    <h1>@@l:nearby1@@</h1>\n    <div class=\"@@s:ns@@_list_column @@s:ns@@_list_input_holder\">\n\t<div class=\"@@s:ns@@_list_formelement\">\n\t    <input autocomplete=\"off\" id=\"@@s:ns@@_ac_list\" placeholder=\"@@l:insertaddress2@@\">\n\t</div>\n\n\t<div class=\"@@s:ns@@_list_formelement @@s:ns@@_list_formelement_radio\">\n\t    <input id=\"@@s:ns@@_list_opennow\" name=\"@@s:ns@@_open\" type=\"radio\"><label><span><span></span></span>@@l:opentoday@@</label>\n\t</div>\n\n\t<div class=\"@@s:ns@@_list_formelement @@s:ns@@_list_formelement_radio\">\n\t    <input id=\"@@s:ns@@_list_openthen\" name=\"@@s:ns@@_open\" type=\"radio\"><label><span><span></span></span>@@l:openthen@@</label>\n\t</div>\n\n\t<div class=\"@@s:ns@@_list_formelement\">\n\t    <select id=\"@@s:ns@@_list_day\" class=\"@@s:ns@@_list_formelement_select\">\n\t\t<option value=\"1\">@@l:d_mon@@</option>\n\t\t<option value=\"2\">@@l:d_tue@@</option>\n\t\t<option value=\"3\">@@l:d_wed@@</option>\n\t\t<option value=\"4\">@@l:d_thu@@</option>\n\t\t<option value=\"5\">@@l:d_fri@@</option>\n\t\t<option value=\"6\">@@l:d_sat@@</option>\n\t\t<option value=\"0\">@@l:d_sun@@</option>\n\t    </select>\n\t</div>\n\n\t<div class=\"@@s:ns@@_list_formelement\">@@l:openat@@</div>\n\n\t<input type=\"time\" id=\"@@s:ns@@_list_openat\" placeholder=\"@@l:timeformat@@\">\n    </div>\n\n    <div class=\"@@s:ns@@_list_column @@s:ns@@_list_items_holder\">\n\t<h3 class=\"@@s:ns@@_list_item_holder_title\">@@l:nearby2@@</h3>\n\t<div id=\"@@s:ns@@_list_items\">\n\t    <div id=\"@@s:ns@@_list_items_placeholder\">\n\t\t<h3>@@l:hint@@</h3>\n\t\t<p>\n\t\t    @@l:hint_search@@\n\t\t</p>\n\t    </div>\n\t</div>\n    </div>\n</div>","map":"<div id=\"@@a:ns@@_map_wrapper\">\n    <div id=\"@@a:ns@@_map_\">\n\t<div id=\"@@a:ns@@_map_toolbar\">\n\t    <div class=\"@@a:ns@@_map_toolbar_row\">\n\t\t<div id=\"@@a:ns@@_map_types\">\n\t\t    <div data-maptype=\"ROADMAP\"   data-label=\"Standard\"></div>\n\t\t    <div data-maptype=\"HYBRID\"    data-label=\"Hybrid\"  ></div>\n\t\t    <div data-maptype=\"SATELLITE\" data-label=\"Satellit\"></div>\n\t\t</div>\n\t\t<div id=\"@@a:ns@@_map_slider\">\n\t\t    <!--[if gte IE 9]><!--><svg unselectable=\"on\" width=\"282\" height=\"32\">\n  <rect height=\"7\" width=\"200\" x=\"41\" y=\"12.5\" rx=\"3.5\" ry=\"3.5\" fill=\"#ffffff\" stroke=\"#D3BCA0\" stroke-width=\"1\"></rect>\n  <line stroke=\"#0000ff\" stroke-linecap=\"round\" stroke-width=\"6.5\" y2=\"16\" y1=\"16\" x1=\"44.75\" x2=\"44.75\"></line>\n  <image width=\"32\" height=\"32\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"//api.valora-stores.com/uploads/images/css/knob.png\" x=\"26.75\" y=\"0\"></image>\n  <text x=\"19\" y=\"23\" text-anchor=\"middle\" stroke=\"#00A6C2\" fill=\"#00A6C2\" stroke-width=\"1\" font-size=\"18\">-</text>\n  <text x=\"263\" y=\"23\" text-anchor=\"middle\" stroke=\"#00A6C2\" fill=\"#00A6C2\" stroke-width=\"1\" font-size=\"18\">+</text>\n</svg><!--<![endif]-->\n\t\t    <!--[if lte IE 8]>\n\t\t\t<div data-zoom=\"-1\" class=\"@@a:ns@@_knob_minus\"></div>\n\t\t\t<div data-zoom=\"1\" class=\"@@a:ns@@_knob_plus\"></div>\n\t\t      <![endif]-->\n\t\t</div>\n\n\t    </div>\n\t</div>\n    </div>\n    <div class=\"@@a:ns@@_map_row\">\n\t<div id=\"@@a:ns@@_map_formats\"></div>\n\t<div id=\"@@a:ns@@_map_services\"></div>\n\n\t<div class=\"@@a:ns@@_geolocate_input_holder\">\n\t    <input id=\"@@a:ns@@_ac_map\" placeholder=\"@@a:insertaddress@@\"/><span class=\"@@a:ns@@_geolocate\">&nbsp;</span>  \n\t</div>\n    </div>\n</div>\n\n"},"MAP_OLD":null,"MAPSETUP":{"config":{"zoom":12,"mapTypeId":"ROADMAP","minZoom":3,"maxZoom":18,"disableDefaultUI":true,"mapTypeControl":false,"mapTypeControlOptions":{"mapTypeIds":{"HYBRID":true,"ROADMAP":true,"SATELLITE":true,"TERRAIN":true},"position":"TOP_RIGHT","style":"DEFAULT"},"overviewMapControl":false,"overviewMapControlOptions":{"opened":false},"panControl":false,"panControlOptions":{"position":"TOP_LEFT"},"rotateControl":false,"rotateControlOptions":{"position":"TOP_LEFT"},"scaleControl":false,"scrollwheel":false,"streetViewControl":false,"streetViewControlOptions":{"position":"TOP_LEFT"},"tilt":0,"zoomControl":false,"zoomControlOptions":{"position":"TOP_LEFT","style":"DEFAULT"},"center":{"lat":47.535,"lng":7.64},"__pins":{"format":{"width":63,"height":73},"loc":{"width":48,"height":48,"name":"loc.gif","include":true,"scalable":true,"centered":true},"scale":{"base":15,"min":0.3}},"__locate":{"google":true}},"area":"ch","stylers":[{"stylers":[]},{"featureType":"road","elementType":"geometry","stylers":[{"lightness":50},{"visibility":"simplified"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]}],"limit":{"minZoom":3,"maxZoom":18}}},opts={protocol:location.protocol.match(/^http/)?"//":"http:",ns:__.INI.USR.NS,z:18},d=document,w=window,IE8=!window.addEventListener,objKeys=function(o){if(Object.keys)return Object.keys(o);else{var ks=[];for(var k in o)ks.push(k);return ks}},cfg=function(c){var CFG=isNaN(__.USR.CFG)?parseInt(__.USR.CFG):__.USR.CFG,CFGS=__.USR.CFGS;if(typeof __.USR.CFGS[c]!=="number")return false;return!!(CFG&__.USR.CFGS[c])},all=function(s){return d.querySelectorAll.call(d,s)},one=function(s){return d.getElementById.call(d,
s)},attr=function(n,a){return n.getAttribute(a)},text=function(s){return d.createTextNode(String(s))},elem=function(t,a,p,s){var node=d.createElement(t);a=a||{},p=p||{},s=s||"";for(var k in a)node.setAttribute(k,a[k]);for(var k in p)node[k]=p[k];if(s)node.style.cssText=s;return node},con=function(f,a){if(location.hash!=="#storefinder.log"&&f!=="err")return;if(IE8)return;var ff={err:1,warn:2,info:4,log:8},aa=[opts.ns+":"];for(var i=0;i<a.length;++i)aa.push(a[i]);(w.console&&w.console[f]?w.console[f]:
function(){}).apply(w.console||w,aa)},log=function(){con("log",arguments)},info=function(){con("info",arguments)},error=function(){con("error",arguments)},warn=function(){con("warn",arguments)},is=function(o,t){if(o===t===null)return true;if(o===null)return false;return typeof o!=="undefined"&&o.constructor===t},__get=function(obj,path,failure,type,silent){var c=obj,_path=path.split(/\./),key;for(var i=0;i<_path.length;++i){key=_path[i];if(typeof c[key]==="undefined"){if(!silent)warn("__get(invalid path)",
arguments);return failure}c=c[key]}switch(type){case 1:if(isNaN(c))return failure;c=Number(c);break;case 2:if(typeof c!=="string")return failure;break;case 3:if(!c||!c.latitude)c={};break;case 4:if(typeof c!=="function")c=failure;break;case 5:if(!c||!c.constructor||c.constructor!==Array)c=failure;break;default:break}return c},selector,g;(function(){var ME=document.querySelectorAll('script[src*="'+__.INI.PATH.SCRIPT+'"]');if(!ME.length){__.API_ERR="cannot detect my settings, I quit!";return}else if(ME.length>
1){__.API_ERR="you must not include this script "+"multiple times!\n I quit!";return}else ME=ME.item(0);__.USR={};__.MC=__.MAPSETUP.config;__.MC.minZoom=Math.max(__.MAPSETUP.limit.minZoom,__.MC.minZoom);__.MC.maxZoom=Math.min(__.MAPSETUP.limit.maxZoom,__.MC.maxZoom);for(var k in __.INI.USR)__.USR[k]=__.INI.USR[k]===""?null:__.INI.USR[k];for(var k in __.USR)(function(v,k){var data=attr(ME,["data",__.INI.DATA[k]].join("-"));if(typeof data==="string"){switch(k){case "zoom":break;case "center":break;
case "NS":__.USR.NS=data;break;default:__.USR[k]=data;break}__[k]=data}})(__.USR[k],k);info("config ready")})();if(__.API_ERR){alert("["+opts.ns+"]:"+__.API_ERR);return}var app={data:{},set_view:function(latlng,zoom,bounds){if(bounds&&bounds.getCenter().toUrlValue()!=="0,-180")app.map.fitBounds(bounds);else{app.map.setCenter(latlng);if(zoom)app.map.setZoom(zoom)}},add_filters:function(f){if(!app.map)return;for(var k in app.data.props.filter)if(__get(app,"add_filter_"+k,false,4))app["add_filter_"+
k](f)},add_filter_services:function(services){if(!app.map){app.data.props.filter.services.__={};return}if(!__get(app,"data.props.filter.services.__",null,null,1))app.data.props.filter.services.__={};for(var k in services)if(!app.data.props.filter.services.__[k]){app.data.props.filter.services.__[k]=new g.m.MVCObject;var service=__get(app,"data.props.filter.services."+k,null);if(!service)continue;var img=app.nodes.map_services.appendChild(elem("img",function(x,s){var o={title:service.service_name,
src:__.INI.PATH.IMG+service.service_logo};if(x){o["data-filter-on"]=1;s.on=1}return o}(cfg("services_uncheck"),service),{className:[__.USR.NS,"filter","service",k].join("_")}));(function(img,id){g.e.d(img,"click",function(){this[this.getAttribute("data-filter-on")?"removeAttribute":"setAttribute"]("data-filter-on",1);app.data.props.filter.services[id].on=this.getAttribute("data-filter-on");g.e.t(app.mvc,"search_changed")});if(cfg("services_uncheck"));})(img,k)}else;},add_filter_formats:function(id){if(!app.map)return;
var format;if(!__get(app,"data.props.filter.formats.__",null,null,1))app.data.props.filter.formats.__={};if(!app.data.props.filter.formats.__[id]){app.data.props.filter.formats.__[id]=new g.m.MVCObject;format=__get(app,"data.props.filter.formats."+id);app.mvc.get("pin_format")[id]=new g.m.MVCObject;var icon={url:__.INI.PATH.IMG+format.format_pin};icon.size=icon.scaledSize=new g.m.Size(app.map.__pins.format.width,app.map.__pins.format.height);app.mvc.get("pin_format")[id].set("icon",icon);var img=
app.nodes.map_formats.appendChild(elem("img",function(x,s){var o={title:format.format_name,src:__.INI.PATH.IMG+format.format_pin};if(x){o["data-filter-on"]=1;s.on=1}return o}(cfg("formats_uncheck"),format),{className:[__.USR.NS,"filter","format",id].join("_")}));g.e.d(img,"click",function(){this[this.getAttribute("data-filter-on")?"removeAttribute":"setAttribute"]("data-filter-on",1);app.data.props.filter.formats[id].on=this.getAttribute("data-filter-on");g.e.t(app.mvc,"search_changed")})}},setMapType:function(item,
items){if(app.map)for(var i=0;i<items.length;++i)if(items.item(i)===item){item.removeAttribute("data-filter-on");app.map.setMapTypeId(g.m.MapTypeId[item.getAttribute("data-maptype")])}else items.item(i).setAttribute("data-filter-on",1)},init:function(){info("init");var loaded={};g={m:google.maps,e:{e:google.maps.event.addListener,d:google.maps.event.addDomListener,t:google.maps.event.trigger,e1:google.maps.event.addListenerOnce,d1:google.maps.event.addDomListenerOnce},p:google.maps.ControlPosition};
g.e.d(window,"sflog",function(){if(confirm("yes:app no:__"))log(app);else log(__)});app.mvc=new g.m.MVCObject;g.e.e(app.mvc,"search_changed",app.filter);app.add_style();for(var k in this.nodes)try{loaded[k]=app["init_"+k].call(app)}catch(e){error("error while loading",k,"init_"+k,e)}var wrappers=document.querySelectorAll(["#"+__.USR.NS+"_map","#"+__.USR.NS+"_list"].join(","));for(var i=0;i<wrappers.length;++i)wrappers.item(i).className=[wrappers.item(i).className,__.USR.NS+"_loaded"].join(" ");if(window.jQuery)try{jQuery(document).trigger(__.USR.NS+
".loaded.all")}catch(e$0){}app.fetch_data();info("app initialized")},init_map_:function(){var node=app.nodes.map_;if(!node)return;var opts=app.map_options(),goo;if(__.INI.LOCATE.google){goo=__get(w,"google.loader.ClientLocation",null);if(goo&&goo.latitude)opts.center={lat:goo.latitude,lng:goo.longitude}}var maptypes=app.nodes.map_.querySelectorAll("div[data-maptype]");for(var i=0;i<maptypes.length;++i)(function(_ctrl){_ctrl.onclick=function(){app.setMapType.call(app,_ctrl,maptypes)};if(opts.mapTypeId!==
g.m.MapTypeId[_ctrl.getAttribute("data-maptype")])_ctrl.setAttribute("data-filter-on",1)})(maptypes.item(i));app.map=new g.m.Map(node,opts);app.mvc.setValues({pin_format:{},pin_fx:null});g.e.e(app.map.get("win"),"map_changed",function(){if(!this.getMap())app.map.pin.setMap(null)});app.map.addListener("pinclick",function(id){log("#"+id,app.data.features.get(id));app.infowin(app.data.features.get(id))});g.e.e(app.map,"zoom_changed",function(e){if(!e&&this.get("__pins")&&this.get("__pins").scale){var scale=
app.pin_scale();if(app.mvc.get("pin_fx")!==scale.x){app.mvc.set("pin_fx",scale.x);for(var k in app.mvc.get("pin_format"))(function(k,v){var icon=v.get("icon"),size=icon.size;icon.scaledSize=new g.m.Size(Math.round(size.width*scale.s),Math.round(size.height*scale.s));icon.anchor=new google.maps.Point(icon.scaledSize.width/2,icon.scaledSize.height);app.mvc.get("pin_format")[k].set("icon",icon)})(k,app.mvc.get("pin_format")[k])}}if(!app.slider)return;if(is(e,Number)&&!isNaN(e)){this.set("z",e);this.setZoom(Math.round(e))}else{var z=
e&&e.zoom?e.zoom:this.get("z")||this.getZoom(),s=app.slider,sb=s.track.getBoundingClientRect(),t=s.track,o=s._p.a,w=t.getAttribute("width"),f=(z-__.MC.minZoom)/(__.MC.maxZoom-__.MC.minZoom),x=w*f+o;s.knob.setAttribute("x",x-app.slider._p.kr*1.25);s.range.setAttribute("x2",x);s.range.style.opacity=f;this.set("z",null)}});info("map initialized");app.init_map_toolbar(app.map);app.init_map_topbar(app.map);app.init_map_leftbar(app.map);app.init_map_rightbar(app.map);app.init_ac("map_",document.getElementById(__.USR.NS+
"_ac_map"));if(window.jQuery)try{jQuery(document).trigger(__.USR.NS+".loaded.map")}catch(e){}},init_map_toolbar:function(map){if(app.nodes.map_toolbar&&(!app.nodes.map_toolbar.parentNode||!app.nodes.map_toolbar.parentNode.tagName)&&map)map.controls[g.p["BOTTOM_CENTER"]].push(app.nodes.map_toolbar)},init_map_topbar:function(map){if(app.nodes.map_topbar&&!app.nodes.map_topbar.parentNode&&map)map.controls[g.p["TOP_CENTER"]].push(app.nodes.map_topbar)},init_map_leftbar:function(map){if(app.nodes.map_leftbar&&
!app.nodes.map_leftbar.parentNode&&map)map.controls[g.p["TOP_LEFT"]].push(app.nodes.map_leftbar)},init_map_rightbar:function(map){if(app.nodes.map_rightbar&&!app.nodes.map_rightbar.parentNode&&map)map.controls[g.p["TOP_RIGHT"]].push(app.nodes.map_rightbar)},init_map_services:function(){},init_map_formats:function(){},init_list:function(){if(!app.nodes.list)return;var btn=app.nodes.list.querySelector("#"+__.USR.NS+"_list_submit");app.nodes.list.innerHTML=app.parse_tpl(__.TPL.list);if(btn)g.e.d(btn,
"click",function(){g.e.t(app.mvc,"search_changed")});var openat=app.nodes.list.querySelector("#"+__.USR.NS+"_list_openat");if(openat){var n=new Date;openat.value=[app.FX.zero(n.getHours()),app.FX.zero(n.getMinutes())].join(":");g.e.d(openat,"keydown",function(e){if(e.keyCode===13&&app.get_active_datetimefilter())g.e.t(app.mvc,"search_changed")});g.e.d(openat,"input",function(){if(app.get_active_datetimefilter()){clearTimeout(app.time_timer);app.time_timer=setTimeout(function(){g.e.t(app.mvc,"search_changed")},
300)}})}var openday=app.nodes.list.querySelector("#"+__.USR.NS+"_list_day");if(openday)g.e.d(openday,"change",function(e){if(app.get_active_datetimefilter())g.e.t(app.mvc,"search_changed")});var opennow=app.nodes.list.querySelector("#"+__.USR.NS+"_list_opennow");if(opennow)g.e.d(opennow,"click",function(e){if(app.get_active_datetimefilter())g.e.t(app.mvc,"search_changed")});var openthen=app.nodes.list.querySelector("#"+__.USR.NS+"_list_openthen");if(openthen)g.e.d(openthen,"click",function(e){if(app.get_active_datetimefilter())g.e.t(app.mvc,
"search_changed")});info("list initialized");app.init_ac("list",document.getElementById(__.USR.NS+"_ac_list"));if(window.jQuery)try{jQuery(document).trigger(__.USR.NS+".loaded.list")}catch(e){}return[app.nodes.list,"list"]},init_map_slider:function(){if(app.nodes.map_slider&&app.map)try{var slider=app.nodes.map_slider.querySelector("svg"),docmove;if(!slider){var knobs=app.nodes.map_slider.querySelectorAll("div[class^="+__.USR.NS+"_knob_");for(var i=0;i<knobs.length;++i)(function(knob){g.e.d(knob,
"click",function(){app.map.setZoom(Math.max(__.MC.minZoom,Math.min(__.MC.maxZoom,app.map.getZoom()+1*knob.getAttribute("data-zoom"))))})})(knobs[i]);return}slider.track=slider.querySelector("rect");slider.knob=slider.querySelector("image");slider.range=slider.querySelector("line");slider.plus=slider.querySelectorAll("text").item(1);slider.minus=slider.querySelectorAll("text").item(0);slider.plus.fx="plus";slider.setAttribute("unselectable","on");g.e.d(slider,"dragstart",function(e){e.preventDefault()});
g.e.d(slider,"selectstart",function(e){e.preventDefault()});slider._p={tw:Number(slider.track.getAttribute("width"))+slider.track.getAttribute("stroke-width")*2,kr:slider.knob.getAttribute("width")/2,a:Number(slider.range.getAttribute("x1")),z:Number(slider.range.getAttribute("x1"))+Number(slider.track.getAttribute("width"))-slider.track.getAttribute("stroke-width")};g.e.d(document,"mouseup",function(){if(slider.knob.grip){slider.knob.grip=false;if(slider.knob.zoom)g.e.t(app.map,"zoom_changed",slider.knob.zoom)}});
g.e.d(document,"touchend",function(){if(slider.knob.grip){slider.knob.grip=false;if(slider.knob.zoom)g.e.t(app.map,"zoom_changed",slider.knob.zoom)}});g.e.d(document,"touchcancel",function(){if(slider.knob.grip){slider.knob.grip=false;if(slider.knob.zoom)g.e.t(app.map,"zoom_changed",slider.knob.zoom)}});g.e.d(slider.knob,"mousedown",function(){slider.knob.grip=true;slider.knob.touch=false});g.e.d(slider.knob,"touchstart",function(){slider.knob.grip=true;slider.knob.touch=true});var f_slide=function(e){if((e.type===
"mousemove"||e.type==="touchmove")&&!slider.knob.grip)return;if(slider.knob.touch&&e.type.match(/mouse/))return;if(e.type==="touchmove")if(e.touches.length>1){slider.knob.grip=null;return}var ex=e.type==="touchmove"?e.touches[0].clientX:e.clientX,sb=slider.track.getBoundingClientRect(),sw=sb.right-sb.left,a=__.MC.minZoom,z=__.MC.maxZoom,sx,f,zoom;if(ex>sb.left&&ex<sb.right){sx=ex-sb.left;f=sx/sw;zoom=Math.max(a,Math.min(z,(z-a)*f+a));if(e.type==="mousemove"||e.type==="touchmove"){slider.knob.zoom=
Math.round(zoom);g.e.t(app.map,"zoom_changed",{zoom:zoom})}else g.e.t(app.map,"zoom_changed",zoom)}};g.e.d(document.body,"mousemove",f_slide);g.e.d(document.body,"touchmove",f_slide);g.e.d(slider.track,"click",f_slide);g.e.d(slider.range,"click",f_slide);g.e.d(slider.plus,"click",function(){g.e.t(app.map,"zoom_changed",Math.min(__.MC.maxZoom,app.map.getZoom()+1))});g.e.d(slider.minus,"click",function(){g.e.t(app.map,"zoom_changed",Math.max(__.MC.minZoom,app.map.getZoom()-1))});app.slider=slider;g.e.t(app.map,
"zoom_changed")}catch(e){log("slider failed",e)}},parse_tpl:function(tpl,opt,props){if(opt&&opt.substr){var list="("+objKeys(props).join("|")+")",pattern="@@"+opt+":"+list+"@@";tpl=tpl.replace(new RegExp(pattern,"g"),function(match){var p;if(p=match.match(new RegExp("\\b"+list+"\\b","g")))return props[p]});return tpl}if(!opt||!opt.substr){if(opt)tpl=app.parse_tpl(tpl,"a",opt);tpl=app.parse_tpl(tpl,"l",__.IL8N);tpl=app.parse_tpl(tpl,"s",{ns:__.USR.NS});return tpl}},get_router:function(feature){return"https://www.google.de/maps/dir/"+
feature.geometry.toUrlValue()+"/"+app.mvc.get("search").toUrlValue()+"/"},infowin:function(feature){var flux=new app.flux(feature,true),remaining="<strong>"+__.IL8N.closed+"</strong>",is_open=flux.check_open(2);if(is_open.val&&__.INI.CFG.REMAININFO){var hh=Math.floor(is_open.val/3600),mm=Math.floor(is_open.val%3600/60);remaining=app.parse_tpl(__.TPL.infobox_storeopen,{display:hh?"block":"none",hours:hh!==1?"@@l:hours@@":"@@l:hour@@",minutes:mm!==1?"@@l:minutes@@":"@@l:minute@@",mm:mm,hh:hh})}else if(is_open.bln){var tbl=
flux.formatted_tbl();if(tbl)remaining=app.parse_tpl(__.TPL.open_time,{open_times:__.IL8N.open_times,open_time_a:tbl[0],open_time_b:tbl.length>1?tbl[1]:"",is_open:is_open.val?"@@l:opened@@":"@@l:closed@@",open_class:is_open.val?"isopen":"isclosed"})}var distance=feature.prop("_distance"),km=distance&&distance.token&&app.token&&app.token===distance.token?distance.value+"km":"",services=feature.prop("_services"),tmp=[],format=app.data.props.filter.formats[feature.prop("store_format")];for(var k in services)tmp.push(app.parse_tpl(__.TPL.list_item_service,
{ns:__.USR.NS,img_root:__.INI.PATH.IMG,service_logo:app.data.props.filter.services[k].service_logo,service_name:app.data.props.filter.services[k].service_name}));var content=this.parse_tpl(__.TPL.infobox,{store_name:feature.prop("store_name"),store_street:feature.prop("store_street"),store_streetnr:feature.prop("store_streetnr"),store_zip:feature.prop("store_zip"),store_city:feature.prop("store_city"),store_phone:feature.prop("store_phone"),store_fax:feature.prop("store_fax"),store_www:feature.prop("store_www"),
country_name:app.data.props.filter.countries[feature.prop("store_country")].land_name,format_logo:format.format_logo,distance:km,router:km?app.get_router(feature):"#",remaining:remaining,services:tmp.join(" "),ns:__.USR.NS});app.map.get("pin").setValues({icon:[__.INI.PATH.IMG+format.format_pin],map:app.map,position:feature.geometry});app.map.win.setOptions({map:app.map,content:content,zIndex:-100,position:feature.geometry})},add_data:function(data){if(!app.data.features){app.features.prototype.get=
function(id){return this.items[id]};app.feature.prototype.prop=function(p){var pp=this.properties;if(p.indexOf("_")===0)return pp[p];return app.data.mapping[p].converter?pp._[app.data.mapping[p].index]*1:pp._[app.data.mapping[p].index]};app.feature.prototype.setProp=function(k,v){this.properties[k]=v};if(app.map){g.m.Marker.prototype.prop=function(p){return this.feature().prop(p)};g.m.Marker.prototype.feature=function(){return app.data.features.get(this.get("id"))}}app.data.features=new app.features}var datacount=
0,start=(new Date).getTime(),bounds=new google.maps.LatLngBounds;if(!app.data.mapping){app.data.mapping={};var j=0;for(var k in data.mappings)app.data.mapping[k]={index:j++,converter:data.mappings[k]}}app.data.props=data.props;if(app.map)app.mvc.set("map",app.map);for(var k in data.items)(function(item){var feature={"geometry":new g.m.LatLng(item[app.data.mapping.lat.index]*1,item[app.data.mapping.lng.index]*1),"properties":{_:item,_services:{}},"id":item[app.data.mapping.id.index]*1},_services=item[app.data.mapping.services.index];
if(item[app.data.mapping.id.index]==="2759")console.log(item);if(!_services.length&&app.nodes.map_services&&app.nodes.map_services.offsetHeight);for(var i=0;i<_services.length;++i)feature.properties._services[_services[i]]=_services[i];app.data.features.items[feature.id]=new app.feature(feature);datacount++;if(app.map){app.add_filter_services(feature.properties._services);app.add_filter_formats(feature.properties._[app.data.mapping["store_format"].index]*1);app.pin(feature);bounds.extend(feature.geometry)}})(data.items[k]);
if(app.map)if(datacount>0)if(datacount===1)app.map.setCenter(bounds.getCenter());else app.map.fitBounds(bounds);log(datacount+" items parsed in "+((new Date).getTime()-start)/1E3+"sec");if(app.get_active_datetimefilter()||1)app.filter();return datacount},features:function(){this.items={};return this},feature:function(o){for(var k in o)this[k]=o[k];return this},pin:function(feature){feature=app.data.features.get(feature.id);var pin=new g.m.Marker({position:feature.geometry,id:feature.id,title:feature.prop("store_name")});
pin.bindTo("icon",app.mvc.get("pin_format")[feature.prop("store_format")],"icon");pin.bindTo("map",app.mvc,"map");g.e.e(pin,"click",function(){g.e.t(this.getMap(),"pinclick",this.get("id"))});g.e.e(pin,"map_changed",function(){if(!this.getMap()){this.unbindAll();g.m.event.clearInstanceListeners(pin)}})},fetch_data:function(){log("requesting data");var sstart=(new Date).getTime(),tmp=[opts.ns,"callback",sstart].join("_"),script=null,params=[],query=[],url;window[tmp]=function(data){log("request took "+
((new Date).getTime()-sstart)/1E3+"sec");if(app.map)g.e.t(app.map,"resize");var datacount=0;if(data.items)datacount=app.add_data(data);try{script.parentNode.removeChild(script);window[tmp]=null;delete window[tmp]}catch(e){log(e)}};query[__.INI.PARAM.key]=__.KEY;query[__.INI.PARAM.action]=__.INI.RUN.data;query[__.INI.PARAM.callback]=tmp;query[__.INI.PARAM.cfg]=isNaN(__.USR.CFG)?parseInt(__.USR.CFG):__.USR.CFG;for(var k in query)params.push([k,encodeURIComponent(query[k])].join("="));url=__.INI.PATH.DATA+
params.join("&");script=load(url)},pin_scale:function(){if(!__.MC.__pins||!__.MC.__pins.scale)return 1;var scale=app.map.get("__pins").scale,i=Math.min(Number(scale.base),app.map.maxZoom-app.map.minZoom),z=app.map.getZoom(),f=(app.map.getZoom()-app.map.minZoom)/(app.map.maxZoom-app.map.minZoom),s=f+Number(scale.min)-f*scale.min,x=Math.round(f*i),r={f:f,s:s,x:x};return r},add_style:function(s,r){var params={},enc=[],url=__.INI.PATH.SCRIPT,sheet=document.createElement("link");params[__.INI.PARAM.namespace]=
__.USR.NS;params[__.INI.PARAM.key]=__.KEY;params[__.INI.PARAM.action]="css";if(__.INI.FRAMED)params[__.INI.PARAM.framed]=__.INI.FRAMED;for(var p in params)enc.push([p,encodeURIComponent(params[p])].join("="));url+=enc.join("&");sheet.setAttribute("rel","stylesheet");sheet.setAttribute("type","text/css");sheet.setAttribute("href",url);document.getElementsByTagName("head")[0].appendChild(sheet);return},map_options:function(o){var MO=__.MC;MO.zoom=Math.min(Math.max(MO.zoom,MO.minZoom),MO.maxZoom);try{MO.mapTypeId=
g.m.MapTypeId[MO.mapTypeId]}catch(e){log("MC:mapTypeId not set")}try{(function(o,a){for(var k in o.mapTypeIds)if(o.mapTypeIds[k])a.push(g.m.MapTypeId[k]);o.mapTypeIds=a})(MO.mapTypeControlOptions,[])}catch(e$1){log("MC:mapTypeIds not set")}try{MO.zoomControlOptions.style=g.m.ZoomControlStyle[MO.zoomControlOptions.style]}catch(e$2){log("MC:zoomControlStyle not set")}try{MO.zoomControlOptions.position=g.m.ControlPosition[MO.zoomControlOptions.position]}catch(e$3){log("MC:zoomControlPosition not set")}try{MO.streetViewControlOptions.position=
g.m.ControlPosition[MO.streetViewControlOptions.position]}catch(e$4){log("MC:streetViewControlPosition not set")}try{MO.rotateControlOptions.position=g.m.ControlPosition[MO.rotateControlOptions.position]}catch(e$5){log("MC:rotateControlPosition not set")}try{MO.panControlOptions.position=g.m.ControlPosition[MO.panControlOptions.position]}catch(e$6){log("MC:panControlPosition not set")}try{MO.mapTypeControlOptions.position=g.m.ControlPosition[MO.mapTypeControlOptions.position]}catch(e$7){log("MC:mapTypeControlPosition not set")}try{MO.mapTypeControlOptions.style=
g.m.MapTypeControlStyle[MO.mapTypeControlOptions.style]}catch(e$8){log("MC:mapTypeControlStyle not set")}if(__.MAPSETUP.stylers&&__.MAPSETUP.stylers.length)MO.styles=__.MAPSETUP.stylers;MO.win=new g.m.InfoWindow({pixelOffset:new g.m.Size(0,-20),marker:new g.m.Marker});MO.pin=function(){var fx=function(){this.onAdd=function(){var pin=document.createElement("img");pin.style.position="absolute";pin.style.zIndex=1200;this.set("pin",pin);this.getPanes().floatPane.appendChild(this.pin)};this.draw=function(){var pos=
this.getProjection().fromLatLngToDivPixel(this.get("position"));this.pin.style.width=MO.__pins.format.width+"px";this.pin.style.height=MO.__pins.format.height+"px";this.pin.style.left=pos.x+"px";this.pin.style.top=pos.y+"px";this.pin.style.marginTop="-"+MO.__pins.format.height+"px";this.pin.style.marginLeft="-"+MO.__pins.format.width/2+"px";this.pin.src=this.get("icon")};this.onRemove=function(){this.get("pin").parentNode.removeChild(this.get("pin"));this.set("pin",null)}};fx.prototype=new google.maps.OverlayView;
return new fx}();MO.loc=function(){if(!MO.__pins.loc)return null;var fx=function(){this.onAdd=function(){var img=document.createElement("img"),that=this;img.src=this.get("src");img.style.position="absolute";this.set("img",img);this.getPanes().overlayImage.appendChild(img)};this.draw=function(){var x=2,y=this.get("centered")?2:1,s=this.get("scalable")?app.pin_scale():{s:1},w=s.s*this.get("width"),h=s.s*this.get("height"),p=this.getProjection().fromLatLngToDivPixel(this.get("position"));this.get("img").style.left=
p.x-w/x+"px";this.get("img").style.top=p.y-h/y+"px";this.get("img").style.width=w+"px";this.get("img").style.height=h+"px"};this.onRemove=function(){this.get("img").parentNode.removeChild(this.get("img"));this.set("img",null)}};fx.prototype=new google.maps.OverlayView;return new fx}(MO);if(MO.loc)MO.loc.setValues({width:Number(MO.__pins.loc.width),height:Number(MO.__pins.loc.height),src:__.INI.PATH.CSS+MO.__pins.loc.name,scalable:MO.__pins.loc.scalable,include:MO.__pins.loc.include,centered:MO.__pins.loc.centered});
return MO},get_active_datetimefilter:function(){if(app.nodes.list){var boxes=["openthen","opennow"],t,hhmm,h,m,d,r;for(var i=0;i<boxes.length;++i){var box=app.nodes.list.querySelector("#"+__.USR.NS+"_list_"+boxes[i]);if(box&&box.checked){r={"src":boxes[i],d:null,hm:{}};t=app.nodes.list.querySelector("#"+__.USR.NS+"_list_openat");if(t){hhmm=t.value.split(":");if(hhmm.length===2){h=parseInt(hhmm[0]);m=parseInt(hhmm[1]);if(!isNaN(h)&&h>=0&&h<24&&(!isNaN(m)&&m>=0&&m<60))r.hm={h:h,m:m}}}d=app.nodes.list.querySelector("#"+
__.USR.NS+"_list_day");if(d)r.d=d.value;return r}}}return null},filtered:function(){var formats={},services={},day=864E5,now=new Date,items=[];try{for(var k in app.data.props.filter.formats)if(app.data.props.filter.formats[k].on)formats[k]=1}catch(e){log(e)}try{for(var k in app.data.props.filter.services)if(app.data.props.filter.services[k].on)services[k]=1}catch(e$9){log(e$9)}var keys=objKeys(services);for(var k in app.data.features.items)(function(item){if(formats[item.prop("store_format")])if(cfg("formats_showallifnone")&&
objKeys(formats).length===objKeys(app.data.props.filter.formats.__).length);else return;if(!app.map||objKeys(app.data.props.filter.services.__).length===keys.length&&cfg("services_showallifnone"));else{var skeys=item.prop("services").slice(0);if(app.nodes.map_services&&app.nodes.map_services.offsetHeight){if(!skeys.length)return;if(keys.length){for(var i=skeys.length;i>=0;--i)if(services[skeys[i]])skeys.pop();if(!skeys.length)return}}}var ff=new app.flux(item);if(!ff.check_open(1).bln)return;items.push(item)})(app.data.features.get(k));
log("filtered items:"+items.length);return items},filter:function(latlng){if(!app.data.features)return;var sort=app.mvc.get("search");if(sort&&!sort.toUrlValue)sort=new g.m.LatLng(sort.lat,sort.lng);if(sort&&app.map&&app.map.get("loc"))app.map.get("loc").setValues({map:app.map,position:sort});var token=app.token="_t1"+(new Date).getTime();if(app.map){app.mvc.set("map",null);app.mvc.set("map",app.map);app.map.win.setMap(null)}if(app.nodes.list)app.insert_listitem(null,true,token);var filtered=app.filtered();
if(sort)var sorted=filtered.sort(function(a,b){if(typeof a.prop(token)==="undefined"){a.setProp(token,g.m.geometry.spherical.computeDistanceBetween(sort,a.geometry));a.setProp("_distance",{type:"crow",value:(a.prop(token)/1E3).toFixed(1),token:token})}if(typeof b.prop(token)==="undefined"){b.setProp(token,g.m.geometry.spherical.computeDistanceBetween(sort,b.geometry));b.setProp("_distance",{type:"crow",value:(b.prop(token)/1E3).toFixed(1),token:token})}return a.prop(token)-b.prop(token)});else sorted=
filtered;if(sort&&sorted.length===1)sorted[0].setProp("_distance",{type:"crow",value:(g.m.geometry.spherical.computeDistanceBetween(sort,sorted[0].geometry)/1E3).toFixed(1),token:token});var count=0,bounds=new g.m.LatLngBounds;if(sort&&app.map&&app.map.get("loc")&&app.map.get("loc").get("include"))bounds.extend(sort);for(var i=0;i<sorted.length;++i)(function(item){if(app.map)new app.pin(item);if(count<10||!sort){bounds.extend(item.geometry);if(sort)app.insert_listitem(item,null)}++count})(sorted[i]);
if(sort&&sorted.length)app.distancematrix(sort,sorted.slice(0,10),token);if(app.map)app.set_view(latlng,null,bounds)},list_item_services:function(feature){if(1)return"";var services=[],service_ids=feature.prop("services");for(var i=0;i<service_ids.length;++i)(function(id){var service=app.data.props.filter.services[id];service.img_root=__.INI.PATH.IMG;service.ns=__.USR.NS;services.push(app.parse_tpl(__.TPL.list_item_service,service))})(service_ids[i]);return services.join("")},distancematrix:function(origin,
dests,token){var destinations=[],OK=g.m.DistanceMatrixStatus.OK;for(var i=0;i<dests.length;++i)destinations.push(dests[i].geometry);if(!app.matrix)app.matrix=new g.m.DistanceMatrixService;app.matrix.getDistanceMatrix({origins:[origin],destinations:destinations,travelMode:g.m.TravelMode.DRIVING},function(response,status){if(app.token!==token)return;if(status!=OK){warn("matrix",status);return}var items=response.rows[0].elements;for(var i=0;i<items.length;++i)(function(feature,result){var id=feature.id,
listItem=document.getElementById(__.USR.NS+"_list_item_"+id);if(result.status!==OK)return;feature.setProp("_distance",{token:token,value:(result.distance.value/1E3).toFixed(1),type:"car"});if(listItem){var listKm=listItem.querySelector("."+__.USR.NS+"_list_item_km");if(listKm)listKm.innerHTML=feature.prop("_distance").value;var listMode=listItem.querySelector("."+__.USR.NS+"_list_item_mode");if(listMode)listMode.innerHTML=__.IL8N.car}})(dests[i],items[i])})},insert_listitem:function(feature,clear,
token){if(app.nodes.list){var target=app.nodes.list.querySelector("#"+__.USR.NS+"_list_items");if(clear){target.innerHTML="";return}var content=app.parse_tpl(__.TPL.list_item,{store_name:feature.prop("store_name"),store_city:feature.prop("store_city"),store_country:app.data.props.filter.countries[feature.prop("store_country")].land_name,store_id:feature.prop("store_id"),store_zip:feature.prop("store_zip"),store_street:feature.prop("store_street"),store_streetnr:feature.prop("store_streetnr"),store_phone:feature.prop("store_phone"),
store_fax:feature.prop("store_fax"),store_www:feature.prop("store_www"),ns:__.USR.NS,services:app.list_item_services(feature),distance:feature.prop("_distance").value,root:__.INI.PATH.IMG,format_logo:app.data.props.filter.formats[feature.prop("store_format")].format_logo}),node=elem("div");node.innerHTML=content;var intoview=node.querySelector([".",__.USR.NS,"_list_item_intoview"].join(""));if(intoview)if(app.map)g.e.d(intoview,"click",function(){g.e.t(app.map,"pinclick",feature.id);app.set_view(feature.geometry,
opts.z,null);app.map.getDiv().scrollIntoView()});else intoview.style.visibility="hidden";target.appendChild(node)}},geolocate:function(node,success){navigator.geolocation.getCurrentPosition(success,function(){var cl=__get(google,"loader.ClientLocation");if(cl&&cl.latitude)success({coords:{latitude:cl.latitude,longitude:cl.longitude}});log("geolocation fails")},{timeout:5E3})},init_ac:function(o,input){if(!input)return;if(!app.acs)app.acs={};var ac=new g.m.places.Autocomplete(input,function(area){if(!area||
!area.match(/\S/))return{types:["geocode"]};_area=area.split(/,/);if(_area.length===1)return{types:["geocode"],componentRestrictions:{country:_area[0]}};else{var bbs={de:new g.m.LatLngBounds(new g.m.LatLng(47.270112,5.866342),new g.m.LatLng(55.073823,15.041896)),ch:new g.m.LatLngBounds(new g.m.LatLng(45.81792,5.95608),new g.m.LatLng(47.808455,10.49234)),at:new g.m.LatLngBounds(new g.m.LatLng(46.372336,9.530783),new g.m.LatLng(49.020608,17.160686)),lu:new g.m.LatLngBounds(new g.m.LatLng(49.447779,
5.73567),new g.m.LatLng(50.18282,6.53097))},bb=new g.m.LatLngBounds,s=false;for(var i=0;i<_area.length;++i)if(bbs[_area[i]]){bb.union(bbs[_area[i]]);s=true}if(!s)return{types:["geocode"]};else return{types:["geocode"],bounds:bb}}return{types:["geocode"]}}(__.MAPSETUP.area));if(input.nextSibling&&input.nextSibling.className==__.USR.NS+"_geolocate"){var geoloc=input.nextSibling;if(!navigator.geolocation)geoloc.parentNode.removeChild(geoloc);else g.e.d(geoloc,"click",function(){app.geolocate(o,function(pos){var place=
{geometry:{location:new g.m.LatLng(pos.coords.latitude,pos.coords.longitude)}};if(!app.geocoder)app.geocoder=new google.maps.Geocoder;app.geocoder.geocode({location:place.geometry.location},function(r,s){if(g.m.GeocoderStatus.OK===s){place.formatted_address=place.name=r[0].formatted_address;ac.set("place",place);input.value=r[0].formatted_address}})})})}app.acs[o]=input;g.e.d(input,"keydown",function(e){if(1&&0&&e.keyCode===13&&!e.triggered){g.e.t(this,"keydown",{keyCode:40});g.e.t(this,"keydown",
{keyCode:13,triggered:true})}});g.e.e(ac,"place_changed",function(address){var p=this.getPlace();app.insert_listitem(null,true);if(p.geometry){if(__.INI.CFG.ACSYNC)for(var k in app.acs)if(app.acs[k]!==input)app.acs[k].value=p.name;app.mvc.set("search",p.geometry.location)}})},sync:function(input,str){},FX:{zero:function(num,min){if(!min)min=10;if(num<min)return"0"+num;return num}},flux:function(feature,forceToday){var that=this,filter=app.get_active_datetimefilter();that.opts={spd:86400,today:!!forceToday,
filter:filter,filterhm:filter&&filter.hm&&!isNaN(filter.hm.h),targetTime:new Date,now:new Date};that.feature=feature;this.times={};if(!that.opts.today&&(!that.opts.filter||that.opts.filter.src==="opennow"||that.opts.filter.d===null))that.opts.today=true;if(!that.opts.today){var day_offset=(that.opts.filter.d-that.opts.now.getDay()+7)%7;if(!day_offset)day_offset+=7;that.opts.targetTime.setTime(that.opts.targetTime.getTime()+day_offset*864E5)}this.create_times(that.opts.targetTime,["start","end","now",
"then"],forceToday);this.create_timetable=function(){var day=that.weekday,tbl=[],foo={a:feature.prop(["open",day,"a"].join("_")),b:feature.prop(["open",day,"b"].join("_")),c:feature.prop(["open",day,"c"].join("_")),z:feature.prop(["open",day,"z"].join("_"))};that.offset=function(day){_day=day?day-1:6;var close=feature.prop(["open",_day,"z"].join("_"));return close>86400?close%86400:0}(day);if(foo.a&&foo.z)if(foo.b&&foo.c)tbl=[[foo.a,foo.b],[foo.c,foo.z]];else tbl=[[foo.a,foo.z]];this.tbl=tbl};this.create_timetable();
this.create_feast=function(){var feasts=feature.prop("feasts")||[],_feasts=app.data.props.feasts;for(var i=0;i<feasts.length;++i)if(_feasts[feasts[i]]&&_feasts[feasts[i]].date&&_feasts[feasts[i]].date.length&&Number(_feasts[feasts[i]].date[0])===that.month&&Number(_feasts[feasts[i]].date[1])===that.day){that.feast=_feasts[feasts[i]].name;return}that.feast=null};that.between=function(target,range){return target>=range[0]&&target<=range[1]};this.create_feast();this.create_ex();this.create_ranges=function(){that.ranges=
{open:that.tbl||[],closed:[]};if(that.feast)that.ranges.open=[];if(!that.ex.open.length&&that.ex.closed.length)return;if(that.ex.closed.length&&that.ranges.open.length)for(var c=0;c<that.ex.closed.length;++c)for(var o=that.ranges.open.length-1;o>=0;--o)(function(o,cc){var oo=that.ranges.open[o];if(cc.a<oo[0]&&cc.z>oo[1]){that.ranges.open.splice(o,1);return}if(cc.a>oo[0]&&cc.z<oo[1]){that.ranges.open.splice(o,1);that.ranges.open.push([oo[0],cc.a]);that.ranges.open.push([cc.z,oo[1]]);return}if(that.between(cc.a,
oo)){that.ranges.open[o][1]=cc.a-1;return}if(that.between(cc.z,oo)){that.ranges.open[o][0]=cc.z+1;return}})(o,that.ex.closed[c]);for(var k in that.ex)for(var i=0;i<that.ex[k].length;++i)that.ranges[k].push([that.ex[k][i].a,that.ex[k][i].z])};this.create_ranges();return this}};app.flux.prototype.create_ex=function(){var that=this,ex=that.feature.prop("openx"),spd=that.opts.spd;that.ex={open:[],closed:[]};for(var i=0;i<ex.length;++i)for(var ii=0;ii<ex[i].length;++ii){var a=that.times.start.unix,aa=
ex[i][ii][0],b=that.times.end.unix,bb=ex[i][ii][1];if(a<=bb&&b>=aa)that.ex[!!i?"open":"closed"].push({a:Math.max(ex[i][ii][0],that.times.start.unix)%spd,z:Math.min(ex[i][ii][1],that.times.end.unix)%spd,zz:ex[i][ii][1],reason:ex[i][ii][2],override:!!ex[i][ii][3],open:!!i})}};app.flux.prototype.check_open=function(opt){var that=this,ranges_open=that.ranges.open.slice();if(that.offset)ranges_open.unshift([0,that.offset]);switch(opt){case 1:for(var i=0;i<ranges_open.length;++i)if(that.opts.filterhm&&
that.between(that.times.then.sec,ranges_open[i])||that.opts.filter&&!that.opts.filterhm&&(that.times.then.unix===that.times.now.unix&&ranges_open[i][1]>that.times.now.sec||that.times.then.unix!==that.times.now.unix&&ranges_open.length)||!that.opts.filter)return{bln:true};return{bln:false};break;case 2:var r={bln:false};for(var i=0;i<ranges_open.length;++i){if(that.between(that.times.now.sec,ranges_open[i])){r.val=ranges_open[i][1]-that.times.now.sec;r.bln=true;return r}if(ranges_open[i][1]>that.times.now.sec)r.bln=
true}return r;break}};app.flux.prototype.create_times=function(time,parts,forceToday){var that=this,spd=that.opts.spd;for(var i=0;i<parts.length;++i)(function(p){var t=new Date,tt={};t.setTime(time.getTime());switch(p){case "start":t.setHours(0,0,0,0);break;case "end":t.setHours(23,59,59,0);break;case "now":t=new Date;break;case "then":if(that.opts.filterhm)t.setHours(that.opts.filter.hm.h,that.opts.filter.hm.m,0,0);break;default:break}if(p==="then"){that.weekday=t.getDay();that.day=t.getDate();that.month=
t.getMonth()+1}t.setTime(t.getTime()-time.getTimezoneOffset()*6E4);tt.unix=Math.floor(t.getTime()/1E3);tt.sec=tt.unix%spd;tt.time=t;that.times[p]=tt})(parts[i])};app.flux.prototype.formatted_tbl=function(){var that=this,a=[];if(!that.tbl.length)return null;for(var i=0;i<that.tbl.length;++i)a.push([that.formatted_time_bysec(that.tbl[i][0]),that.formatted_time_bysec(that.tbl[i][1])].join(" - "));return a};app.flux.prototype.formatted_time_bysec=function(_sec){var that=this,sec=_sec%86400,h=Math.floor(sec/
3600),m=Math.floor(sec%3600/60);if(h<10)h="0"+h;if(m<10)m="0"+m;return[h,m].join(":")};function addEvent(t,e,f){var ff=f;if(t===w&&e==="load"){if(d.readyState==="complete"){f();return}e="readystatechange";t=d;ff=function(){if(d.readyState==="complete")f()}}if(IE8&&t.tagName==="SCRIPT"&&e==="load"){e="readystatechange";ff=function(){if(t.readyState==="loaded")f()}}if(t.addEventListener)t.addEventListener(e,ff,false);else if(t.attachEvent)t.attachEvent("on"+e,ff);else err("addEvent not supported")}
function load(u,a,b,c,s){a=typeof a==="function"?a:function(){return true};b=typeof b==="function"?b:function(){return true};c=typeof c==="function"?c:function(){return true};if(a(b,c)){var n=d.createElement("script");if(!s)n.setAttribute("async",true);addEvent(n,"load",function(){b(c)});n.src=u;d.getElementsByTagName("head")[0].appendChild(n);return n}return null}addEvent(window,"load",function(){var items=["list","map_","map_toolbar","map_topbar","map_leftbar","map_rightbar","map_services","map_formats",
"map_slider"],proceed=false,list;var mapwrapper=document.getElementById(__.USR.NS+"_map");if(mapwrapper){addEvent(mapwrapper,"contextmenu",function(e){e.preventDefault();return false});var content=app.parse_tpl(__.TPL.map,{ns:__.USR.NS,insertaddress:__.IL8N.insertaddress});mapwrapper.innerHTML=content}for(var i=0;i<items.length;++i){list=document.getElementById(__.USR.NS+"_"+items[i]);if(list){if(!app.nodes)app.nodes={};app.nodes[items[i]]=list;continue}if(!list)info(items[i]+" not in use")}if(!app.nodes)error(opts.ns+
":neither "+items.join(" nor ")+" has been included, I quit!");load("https://www.google.com/jsapi",function(b,c){if(window.google){if(google.maps&&google.maps.Map){info("google.maps-library already loaded");c();return false}if(google.load){info("jsapi already loaded");b(c);return false}}return true},function(c){var props={"callback":c,"other_params":[["libraries",encodeURIComponent("geometry,places")].join("=")]},pp=[];if(typeof __.USR.GOOKEY==="string"&&__.USR.GOOKEY.match(/\S/))props.other_params.push(["key",
encodeURIComponent(__.USR.GOOKEY)].join("="));if(typeof __.USR.GOOLANG==="string")props.other_params.push(["language",encodeURIComponent(__.USR.GOOLANG)].join("="));props.other_params=props.other_params.join("&");google.load("maps","3",props)},function(){addEvent(w,"load",function(){app.init.call(app)})})})})();
